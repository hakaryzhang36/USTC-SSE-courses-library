> 本章考点
> 1. 数据链路层的帧结构必须掌握
> 2. 传输时间和传播时间的定义，计算，特别是在不同层的计算
> 3. 无线局域网的分类，网络拓扑形式
> 4. 点对点广域网及其与最小子网的关系，PPP协议

**IEEE 802 项目**
该标准化项目将数据链路层细分为两个子层:
- 逻辑链路控制(LLC)
- 媒体访问控制(MAC)。
除此之外，还建立了一些物理层的标准。

802 标准和传统 OSI 模型的对应关系
![[attachments/Pasted image 20221116182228.png]]


# 有线局域网 LAN

局域网技术有很多种，如以太网、令牌环、令牌总线、FDDI和ATM局域网，但以太网是迄今为止的主导技术。

## CSMA/CD

有线局域网共享信道，可能发生碰撞，由此提出了 CSMA/CD 碰撞检测协议。

> 考点：传输时间和传播时间的定义，计算，特别是在不同层的计算

最大传输时间 $T_p$ 是由以太网标准给定的。
![[attachments/Pasted image 20221116190038.png]]

### 时序
用到了 **二进制退避算法**。其中，$T_{fr}$ 是最大传输时间 $T_p$ 的两倍。
![[attachments/Pasted image 20221116190132.png]]

### 标准以太网的传输介质标准
依照 CSMA/CD 的要求，可以得到不同传输速度线缆的最大长度。*线材长度过长，传输速率会衰减，导致最短帧长 和 最大传输时间 不匹配，CSMA/CD 就会出问题。*
![[attachments/Pasted image 20221116190819.png]]
*前面的数字表示 传输速率（Mbps）；Base 表示基带传输*

## 802.3 帧格式

> 考点：数据链路层的帧结构必须掌握

![[attachments/Pasted image 20221116182458.png]]
![[attachments/Pasted image 20221116182506.png]]

为什么有最大长度限制？  
1. 在设计以太网时，内存非常昂贵，最大长度限制有助于减少缓冲区的大小，网卡实现串并转换需要将 CPU 来的数据放入缓冲区再串行发送。  
2. 第二，最大长度限制防止一个站点垄断共享媒体。

为什么有最短帧长限制？
为了 CSMA/CD 的碰撞检测。


## 编址
**以太网地址**，48 bit，分成6字节，每字节以2位十六进制数表示。

第一个字节的最低有效位定义了地址的类型。如果位为0（低位十六进制数为偶数），则为单播地址；位为1就是多播。

广播地址：FF:FF:FF:FF:FF:FF

**传输方式**
在帧中，MAC地址 字节从左到右 -> 从高位到低位，但是每个字节 从左到右 -> 从低位到高位。
原本的MAC：47:20(0100 0111:0010 0000)
帧中的MAC：     (1110 0010:0000 0100)

## 以太网
![[attachments/Pasted image 20221116190312.png]]


## 新的以太网标准
- 快速以太网
- 吉比特以太网

由于实现了全双工通信，碰撞不再存在。
![[attachments/Pasted image 20221116191954.png]]
此时，电缆的最大长度是由电缆中的信号衰减决定的。

# 无线局域网 WLAN
## WLAN 分类

> 考点：无线局域网的分类

![[attachments/Pasted image 20221116205537.png]]

## CSMA/CA

无线局域网不能实现CSMA/CD有三个原因:  

1. 为了进行碰撞检测，站必须能够同时发送数据和接收碰撞信号。这可能意味着带宽需求增加。  
2. 由于隐藏站的问题，可能检测不到碰撞。  
3. 站之间的距离可能很大。信号减弱可以防止一端的站监听到另一端的碰撞。

所以提出 CSMA/CA 碰撞避免协议。

### 时序
![[attachments/Pasted image 20221116205919.png]]

![[attachments/Pasted image 20221116210838.png]]

**网络分配向量 NAV**
当一个站发送一个RTS帧时，它包括它需要占用通道的持续时间。除接收站外的其他站收到 RTS 帧后，启动一个定时器“网络分配向量”。NAV 到期前不再检测信道是否空闲，直接避免碰撞。实现了“虚拟载波监听”。

如果发送 RTS 帧时产生了碰撞，那么接收方肯定不会收到正确的 RTS 帧，自然源站也收不到 CTS 帧，那么就可以认为发生了碰撞。随后源站进入退避。

**为什么需要 ACK 帧**
不同于有线局域网，如果数据发送过程中有新站加入并发送 RTS 帧（因为新站没有 NAV），这种碰撞对源站来说是无法检测的，但接收站能检测到碰撞，所以源站需要根据 ACK 帧确保数据正确发送了。


但是 CSMA/CA 也可能会带来一些问题。

**隐藏站问题**
当有两个站同时向第三站发送消息时，由于两个站之间由于距离问题不能互相通信导致他们收不到对方的 RTS 帧，在各自发送数据时都认为信道时空闲可用的，二者数据会在第三站产生冲突。

**暴露站问题**
当一个站收到另一个站 RTS 帧时，发现数据并非发给自己的，那么它会认为随后一段时间信道被占用了。这将会导致该站若想和第三站通信时，把二者间的空闲信道误认为被占用，无法通信。

**隐藏站问题的解决方式**
在802.11中，通过两次握手的方式给出解决方案。接收数据的第三站会往范围内的所有站发送 CTS 帧，指定的站收到该帧即可占用信道发送数据，其他站收到则抑制发送。

**暴露站问题在 802.11 协议中必然存在**。若要解决该问题，可以采用划分控制信道和数据信道的方式。


## 802.11 帧格式

> 这部分字段很多，建议参考《TCP/IP 协议簇》。

![[attachments/Pasted image 20221116215047.png]]
![[attachments/Pasted image 20221116215107.png]]
*DS：Distribution System*

用于其他站设置 NAV 的 Duration 字段。
![[attachments/Pasted image 20221116215025.png]]

![[attachments/Pasted image 20221116220126.png]]

## 编址
![[attachments/Pasted image 20221116215539.png]]

在不同站/AP间发送的编址示例。
![[attachments/Pasted image 20221116215932.png]]

# 局域网拓扑

> 考点：网络拓扑形式

- 总线型
- 星型
- 环形
- 网状
- 树形

# 点对点广域网 WAN

点对点广域网，是指**从公共网络中获取一条线路来连接两个远程设备的网络**。比如公司在不同地区的办公点想有直接的网络通信，可以搭建一条点对点的广域网链路实现。

> **我学习链路层的一些小困惑**
> 因特网中也必然涉及远距离的传输，但是要注意，我们讨论的因特网常常关心的是网络层 IP 协议、路由协议、路由器之类，从而混淆广域网和链路层设备的功能。
> 
> 我们要时刻记得“链路层是不涉及路由的”，这层的协议只需上层协议告诉自己应该往哪个端口发送帧就可以了！
> 
> **区分网络层、链路层的例子**
> 两地办公点架设了端到端广域网链路。一个 IP 向另一个办公点的一个 IP 发送报文，路由器通过路由协议选出端口发送报文。链路层判断到对面端口的报文需要用到 PPP 协议封装，那么封装后直接就发到对面路由器端口了，中间不再有逻辑上的网络层路由的操作！
> 
> 如果办公点之间不是端到端广域网，那么就走运营商一般提供的交换广域网，这个下一节再说。
> 但是交换广域网也是不涉及路由的，只是说公共的链路层网络拓扑也是错综复杂的，需要根据 IP 地址决定走哪条链路罢了（听着好像是路由的概念，其实不然）。

我们跳过其他端到端广域网协议，直接讲 PPP 协议。正如我们局域网中只讲 802.3 和 802.11 一样。

> 考点：PPP协议

## PPP 帧
![[attachments/Pasted image 20221116221533.png]]
![[attachments/Pasted image 20221116221604.png]]
![[attachments/Pasted image 20221116225447.png]]
*PPP协议使用了HDLC协议封装中的标记字段和FCS校验字段，因为应用于点到点环境，地址的意义不大，因此地址字段以全1的形式被明确下来。*

## LCP 和 NCP
![[attachments/Pasted image 20221116225533.png]]
PPP 数据段一般都是带 IP 报文的，但是端到端链路也是需要一些链路控制操作的，所以数据段有可能是 LCP 报文（类似 ICMP 报文）。

## PPPoE
> 这个技术其实已经很少用了，但是笔者童年对拨号上网印象深刻，故想深究一下其原理。





> 考点：点对点广域网及其与最小子网的关系

# 广域交换网 Switched WAN

# 连接设备

1. 作为TCP/IP的底层技术，今天介绍的众多协议都是IEEE制定的，而不是ISOC或IETF指定的，为什么呢？
2. 数据链路层又分为LLC和MAC两个子层，分别起什么作用？
3. 数据帧中往往包含源地址和目的地址，WLAN中的一个数据帧中为何存在四个地址？
4. 冲突域的定义是？以太网中的冲突域如何影响其帧长？WLAN中又如何在帧中显式指明信道用时来减小冲突域造成的等待时长？
5. ATM、Ethernet中的帧长是多少？
6. 经典著作《TCP/IP协议详解》一书中的实验网络中有一个串行链路运行SLIP(RFC1055)协议，其已经被PPP协议代替，PPP如何实现MAN中internet的跨网通信？PPP中存在MAC子层吗？
7. 从underlying technology中我们看到电信交换网和TCP/IP混杂的影子，比如收发两端的逻辑连接建立与拆除，这对我们今天流行的VPN又有哪些影响？
8. 交换机的生成树协议是如何定义的？
